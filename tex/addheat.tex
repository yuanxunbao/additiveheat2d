\documentclass[a4paper,12pt]{article}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{subfig}
\renewcommand{\figurename}{Fig.}
\renewcommand*{\figureautorefname}{Fig.}
\usepackage{graphicx}
\usepackage{float}
\usepackage{multirow}
\usepackage{placeins}
\usepackage{color}
\usepackage{array}
\usepackage{cancel}
\usepackage[margin=1in]{geometry}
%\usepackage[left=1.5in, right=1.5in]{geometry}

\usepackage[nameinlink,noabbrev]{cleveref}
\crefname{equation}{eq.}{eqs.} % force abbreviated forms for equation "names"
\Crefname{equation}{Eq.}{Eqs.}
\crefname{figure}{fig.}{figs.}
\Crefname{Figure}{Fig.}{Figs.}


%\usepackage{cmbright}
%\renewcommand{\familydefault}{\sfdefault}

\newcommand{\diff}{\mathrm{d}}
\newcommand{\V}[1]{\boldsymbol{#1}}
\newcommand{\B}[1]{\mathbf{#1}}
\newcommand{\myhat}[2]{\hat{#1}_{#2}}
\renewcommand*\arraystretch{1.5}
\renewcommand{\div}[1]{\nabla_{#1} \cdot}
\newcommand{\lapl}{\nabla^2}
\newcommand{\grad}[1]{\nabla_{#1}}
\newcommand{\curl}{\nabla \times}
\newcommand{\Tr}{\mathrm{Tr}}
\newcommand{\op}[1]{\mathcal{#1}}

\newcommand{\yxb}[1]{  {\bf \color{red}{ Bao: #1}} }


\DeclareMathAlphabet\mathbfcal{OMS}{cmsy}{b}{n}


\title{Macroscopic Heat Transfer Model for Additive Manufacturing Testbed Problem}
\author{Yuanxun Bao and Yigong Qin}
\date{\today}


\begin{document}

\maketitle


\section{Macroscopic model}

We model the macroscopic heat transfer in the rectangular domain $\Omega$
\begin{equation}
\frac{\partial T}{ \partial t} = \div{} ( K \grad{} T) + L_m \frac{\partial f_l(T)}{\partial t} \quad \text{in }  \Omega
\end{equation}
with boundary conditions 
\begin{align}
(-K \grad{} T) \cdot \hat{n} = q_s + h(T - T_e) + \epsilon \sigma (T^4 - T_e^4)  & \quad \text{on } \Gamma_{top} \\
(-K \grad{} T) \cdot \hat{n} = 0  & \quad \text{on } \Gamma  \backslash \Gamma_{top}
\end{align}
where $K$ is the heat conductivity, $L_m$ is the latent heat, $h$ is the convective heat transfer coefficient, $\epsilon$ is the thermal radiation coefficient, $\sigma$ is the Stefan-Boltzmann constant, and $L$ is the latent heat. The fluid mass fraction $f_l$ is modeled as
\begin{equation}
f_l(T) =
\left\{
\begin{array}{cc}
1 & T>T_l \\
\frac{T-T_s}{T_l - T_s} & T_s \leq T \leq T_l \\
0 & T < T_s
\end{array}
\right.
\end{equation}
where $T_l$ and $T_s$ are the liquidus and solidus temperature, respectively.
The heat source $q_S$ is modeled as a moving Gaussian
\begin{equation}
q_s(x, t ) = \frac{2Q\eta}{\pi r_b^2} \exp \left( -\frac{ 2(x-V_s t)^2}{ r_b^2} \right),
\end{equation}
where $Q$ is the source of heat power, $\eta$ is the absorption coefficient, $r_b$ is the radius of heat source and $V_s$ is the scanning speed.  

\section{Discretization}
We discretize the domain $\Omega$ using $(N + 1) \times (M+1)$ grid with meshwidth $h$. Let $T_{ij}^n=T(ih, jh, t_n )$ for $i=0,\dots,N$ and $j = 0, \dots, M$.

\begin{equation}
\frac{T_{i,j}^n - T_{i,j}^{n-1}}{\Delta t} = K \frac{T_{i,j+1}^n + T_{i,j-1}^n + T_{i-1,j}^n + T_{i+1,j}^n - 4 T_{i,j}^n }{h^2} + L_m \frac{\partial f_l(T) }{\partial t} \bigg|_{t = t_n}
\end{equation}
At the top boundary $(j=M)$, we treat the convection and radiation term explicitly,
\begin{equation}
-K \frac{T_{i, M+1}^n - T_{i,M-1}^n}{2h} = q_s (ih, t_n) + h (T^{n-1}_{i,M} - T_e) + \epsilon \sigma ( (T^{n-1}_{i,M})^4 - T_e^4), \ i = 0 , \dots , N
\end{equation}

\yxb{1. Can you fill the details of the other boundaries? Basically, no flux BCs. }

\yxb{2. How do we treat the latent heat term? Implicit or explicit? }

Eventually, the linear system of equation should look like 
\begin{equation}
(\B{I} - \alpha \B{L} ) \B{T}^n - \B{N} (\B{T}^n) = \B{T}^{n-1} + \text{BC terms}
\end{equation}
where $\B{L}$ is the discrete 2D laplacian with Neumann BCs and $\B{N}$ is a nonlinear function due the implicit treatment of latent heat term. If we treat the latent heat term explicitly, we need two starting values initially. 

\yxb{3. Can you find out what $\B{L}$, $\B{N}$ and BC terms are?}

\yxb{4. I am afraid we have to solve nonlinear system of equation due to the latent heat term.}


% \bibliographystyle{unsrt}
% \bibliography{../library.bib}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}
